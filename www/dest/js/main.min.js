tabsApp=angular.module("tabsApp",["ionic"]),tabsApp.config(function(t,e,l){l.backButton.previousTitleText(!1),l.backButton.text("返回"),l.backButton.icon("ion-ios-arrow-back"),l.tabs.style("ios").position("bottom"),l.navBar.alignTitle("center"),l.form.checkbox("circle"),e.otherwise("/tabsUrl/homeUrl"),t.state("tabs",{url:"/tabsUrl",abstract:!0,templateUrl:"./modules/tabs.html"}).state("tabs.home",{url:"/homeUrl",cache:!1,views:{tabhome:{templateUrl:"./modules/home/home.html",controller:"homeCtrl"}}}).state("tabs.sights",{url:"/sightsUrl",cache:!1,views:{tabhome:{templateUrl:"./modules/home/sights/sights.html",controller:"sightsCtrl"}}}).state("tabs.hotel",{url:"/hotelUrl",cache:!1,views:{tabhome:{templateUrl:"./modules/home/hotel/hotel.html",controller:"hotelCtrl"}}}).state("tabs.hoteldesc",{url:"/hoteldescUrl/:hid",cache:!1,views:{tabProducts:{templateUrl:"./modules/home/hotel/hoteldesc.html",controller:"hoteldescCtrl"}}}).state("tabs.find",{url:"/findUrl",views:{tabfind:{templateUrl:"./modules/find/find.html",controller:"findCtrl"}}}).state("tabs.info",{url:"/infoUrl",views:{tabProducts:{templateUrl:"./modules/info/info.html",controller:"infoCtrl"}}}).state("tabs.mine",{url:"/mineUrl/:openmodal",cache:!1,views:{tabMine:{templateUrl:"./modules/user/user.html",controller:"userCtrl"}}})}),tabsApp.controller("tabsCtrl",function(t,e){}),tabsApp.filter("time",function(){return function(t){return new Date(1e3*parseInt(t)).toLocaleString().substr(0,20)}});
tabsApp.service("ngAjax",["$http",function(e){this.post=function(n,t){return e({url:n,method:"post",data:t,async:!1,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(n){var t=[];for(var e in n)t.push(encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return t.join("&")}})},this.get=function(n,t){return null==t&&(t={}),e({url:n,method:"GET",async:!1,params:t})}}]);
var urlbase="http://localhost/travel-server/",url_reg=urlbase+"users/doreg.php",url_login=urlbase+"users/dologin.php",url_banner=urlbase+"ads/gets.php",url_hotel=urlbase+"hotel/gets.php?page=",url_hotelone=urlbase+"hotel/getone.php?hid=";
tabsApp.controller("findCtrl",function(n,t){});
tabsApp.controller("homeCtrl",function(t,o,n,e,p){url=url_banner,o.post(url).success(function(o){1==o.code?t.adslist=o.msg:alert(o.msg)}),t.datalist=[],n(function(){t.datalist=t.adslist,p.update(),p.loop(!0)},200),t.prepage=function(){p.previous()},t.nextpage=function(){p.next()},t.chaPage=function(){},e.fromTemplateUrl("./modules/home/mypopover.html",{scope:t}).then(function(o){t.mypop=o}),t.openPop=function(o){t.mypop.show(o)},t.closePop=function(){t.mypop.hide()}});
tabsApp.controller("infoCtrl",function(n,o){});
tabsApp.service("modalService",function(e){this.mymodal1=function(n){e.fromTemplateUrl("./modules/user/login/login.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.login=e}),e.fromTemplateUrl("./modules/user/register/register.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.register=e}),e.fromTemplateUrl("./modules/user/setting/setting.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.setting=e}),e.fromTemplateUrl("./modules/user/withdrawals/withdrawals.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.withdrawals=e}),e.fromTemplateUrl("./modules/user/recharge/recharge.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.recharge=e}),e.fromTemplateUrl("./modules/user/userInfo/userInfo.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.userInfo=e}),n.$on("modal.hidden",function(){console.log("隐藏")}),n.$on("modal.removed",function(){console.log("删除模态框实例")})}});
tabsApp.service("refreshService",function(u){this.refreshSer=function(s){url=url_login,u.post(url,s.log).success(function(e){u.get(url_userinfo+e.uid).success(function(e){s.userList=e,console.log(e),""==e.username?s.userList.userName="金猪宝会员V":s.userList.userName=e.username,s.userList.abvalue=e.abvalue,s.userList.acount=e.acount,s.userList.isnew=e.isnew,s.abvalue=e.abvalue,s.acount=e.acount,s.isnew=e.isnew})})}});
tabsApp.controller("userCtrl",function(e,s,o,n,t,i,u,r,c,a,g,c){function l(e){return 0<document.cookie.length&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}function d(e,s,o){var n=new Date;n.setDate(n.getDate()+o),document.cookie=e+"="+escape(s)+(null==o?"":";expires="+n.toGMTString())}function m(e){d(e,"",-1)}e.imgUrl="./assets/icons/openeye.png",e.userList={},e.userList.userName="登录/注册",e.canClick=!1,o.mymodal1(e),e.userId=localStorage.getItem("uid"),null==e.userId?(e.userList.userName="登录/注册",e.user="./assets/images/user.png"):(n.getUser(e.userId,e),e.user="./assets/images/tou.jpg"),e.log={},e.log.phone="",e.log.password="",e.isCookie=!0,e.myCookie=function(){e.isCookie=!e.isCookie},e.loginShow=function(){e.userId=localStorage.getItem("uid"),null==e.userId?(e.login.show(),e.cusername=l("myphone"),e.cpassword=l("mypasswd"),""!=e.cusername&&""!=e.cpassword&&(e.log.phone=e.cusername,e.log.password=e.cpassword)):e.userInfo.show()},e.closelog=function(){e.login.hide()},e.doLog=function(){1==e.isCookie?(d("myphone",e.log.phone,7),d("mypasswd",e.log.password,7)):(m("myphone"),m("mypasswd")),n.loginSer(e)},e.eyeflag=!0,e.chage=function(){e.eyeflag=!e.eyeflag,e.eyeflag?(e.imgUrl="./assets/icons/openeye.png",null==e.userId?(e.aout="— —",e.userList.abvalue="— —",e.userList.acount="— —",e.userList.isnew="— —"):(e.aout="— —",e.userList.abvalue=e.abvalue,e.userList.acount=e.acount,e.userList.isnew=e.isnew)):(e.imgUrl="./assets/icons/closeeye.png",e.aout="******",e.userList.abvalue="******",e.userList.acount="******",e.userList.isnew="******")},e.userId=localStorage.getItem("uid"),e.regShow=function(){e.register.show()},e.closereg=function(){e.register.hide()},x=999999,y=1e5,e.description="获取验证码";e.reg={username:"",phone:"",password:"",repassword:"",code:""},e.getCode=function(){e.description=rand=parseInt(Math.random()*(x-y+1)+y)},e.ischecked=!0,e.isclick=function(){e.ischecked=!e.ischecked},e.doReg=function(){t.registerSer(e)},e.uaerInfoShow=function(){e.userInfo.show()},e.closeuaerInfo=function(){e.userInfo.hide()},e.settingShow=function(){if(e.userId=localStorage.getItem("uid"),null==e.userId)return e.login.show(),!1;e.setting.show()},e.closesetting=function(){e.setting.hide(),console.log(e.user)},e.signOut=function(){localStorage.removeItem("uid"),e.userList.abvalue="— —",e.userList.acount="— —",e.userList.isnew="— —",e.userList.userName="登录注册",e.user="./assets/images/user.png",e.setting.hide()},t.watch(e)});
tabsApp.controller("hotelCtrl",function(o,t,e,l,s){function c(){t.get(url_hotel+o.curpage).success(function(t){if(0==t.length)return o.isnotlast=!1;1==o.curpage?o.hotelList=t.msg:o.hotelList=o.hotelList.concat(t),console.log("刷新后的数据:",o.hotelList),o.$broadcast("scroll.refreshComplete"),o.$broadcast("scroll.infiniteScrollComplete")})}o.hotelList=[],o.curpage=1,o.isnotlast=!0,o.doRefresh=function(){o.isnotlast=!0,o.curpage=1,c()},o.loadMore=function(){o.curpage++,c()}});
tabsApp.controller("hoteldescCtrl",function(t,e,o,n,i,u,c,l,r){function s(){e.get(url_hotelone+t.curid).success(function(e){console.log(e),t.hotel=e.data,c.title(t.hotel.hotelname)})}t.curid=o.hid,t.userId=localStorage.getItem("uid"),t.loadWait=function(){u.show({template:"加载中..."}),i(function(){u.hide()},3e3)},t.loadWait(),s(),t.chnum=function(e){0!=e&&(t.price+=e*step),t.price<=0&&(t.price=step)},t.tobuy=function(){if(null==localStorage.getItem("uid"))return r.alert({title:"温馨提示",template:"您还未登录，暂不能购买！"}).then(function(e){}),!1;e.get(url_buy+"&pid="+t.curid+"&uid="+t.userId+"&money="+t.price+"&time="+t.time).success(function(e){t.buyyingDat=e,r.confirm({title:e.msg}).then(function(e){e?(s(),console.log("You are sure")):console.log("You are not sure")})})}});
tabsApp.controller("sightsCtrl",function(t,s,l,r,n){url=url_banner,s.post(url).success(function(s){1==s.code?t.adslist=s.msg:alert(s.msg)})});
tabsApp.service("loginService",function(s,n){this.getUser=getUser=function(e,t){n.post(url_login).success(function(e){0==e.code||(t.userList=e,console.log(e),""==e.username?t.userList.userName="金猪宝会员V":t.userList.userName=e.nickname)})},this.loginSer=function(t){return 0==t.log.phone.length?(s.alert({title:"登录提示",template:"手机号不能为空，请重新输入！"}).then(function(e){}),!1):0==t.log.password.length?(s.alert({title:"登录提示",template:"密码不能为空，请重新输入"}).then(function(e){}),!1):(url=url_login,void n.post(url,t.log).success(function(e){t.res=e.code,localStorage.setItem("uid",e.uid),getUser(e.uid,t),s.alert({title:"登录提示",template:e.msg}).then(function(e){if(1==t.res)return t.user="./assets/images/tou.jpg",t.login.hide(),!1})}))}});
tabsApp.service("rechargeService",function(r,n){this.rechargeSer=function(t,e){if(""==t.rech.money||"0"==t.rech.money)r.alert({title:"请输入标准金额"}).then(function(e){});else if(1e4<t.rech.money){r.alert({title:"一次最多可充值10000元"}).then(function(e){})}else e.get(url_setcash+"&uid="+t.userId+"&money="+t.rech.money).success(function(e){t.rechargeData=e,r.alert({title:e.msg}).then(function(e){t.recharge.hide(),n.getUser(t.userId,t)})})}});
tabsApp.service("registerService",function(t,e){this.registerSer=function(r){return 0==r.reg.phone.length?(t.alert({title:"注册提示",template:"手机号不能为空，请重新输入！"}).then(function(e){}),!1):0==r.reg.password.length?(t.alert({title:"注册提示",template:"密码不能为空，请重新输入"}).then(function(e){}),!1):0==r.reg.repassword.length?(t.alert({title:"注册提示",template:"确认密码不能为空，请重新输入"}).then(function(e){}),!1):r.reg.password!=r.reg.repassword?(t.alert({title:"注册提示",template:"两次密码输入不一致！"}).then(function(e){}),!1):0==r.reg.code.length?(t.alert({title:"注册提示",template:"验证码不能为空，请重新输入"}).then(function(e){}),!1):r.reg.code!=rand?(t.alert({title:"注册提示",template:"验证码输入错误"}).then(function(e){}),!1):0==r.ischecked?(t.alert({title:"注册提示",template:"您还未同意网站服务协议"}).then(function(e){}),!1):(url=url_reg,void e.post(url,r.reg).success(function(e){r.reg=e.code,t.confirm({title:"注册提示",template:e.msg}).then(function(e){if(e)return 1==r.reg?(r.register.hide(),r.login.show()):e.msg,r.description="点击获取验证码",!1;console.log("You are not sure")})}))},this.watch=function(t){t.$watch("reg",function(e,r){return t.errorinfo=" ",/^1[34578]\d{9}$/.test(e.phone)?(t.errorinfo="",e.password.length<6?(console.log("密码不能少于六位数"),0==e.password.length?t.errorinfo="":t.errorinfo="密码不能少于六位数",!1):(t.errorinfo="",e.repassword!=e.password?(console.log("两次密码输入不一致"),0==e.repassword.length?t.errorinfo="":t.errorinfo="两次密码输入不一致",!1):void(t.errorinfo=""))):(0==e.phone.length?t.errorinfo="":t.errorinfo="请输入合法的手机号码",!1)},!0)}});
tabsApp.controller("transactionCtrl",function(n,t,s){function a(){s.get(url_funds+"&uid="+n.userId+"&page="+n.transpage).success(function(t){if(0==t.length)return n.isnotlast=!1;0==n.transpage?n.transactions=t:n.transactions=n.transactions.concat(t),console.log("刷新后的数据:",n.transactions),n.$broadcast("scroll.refreshComplete"),n.$broadcast("scroll.infiniteScrollComplete")})}n.userId=localStorage.getItem("uid"),n.transactions=[],n.transpage=-1,n.isnotlast=!0,n.doRefresh=function(){n.isnotlast=!0,n.transpage=0,a()},n.loadMore=function(){n.transpage++,a()}});
tabsApp.service("withdrawalsService",function(i,n){this.withdrawalsSer=function(t,e){if(""==t.withd.money||"0"==t.withd.money)i.alert({title:"请输入标准金额"}).then(function(e){});else if(2e4<t.withd.money){i.alert({title:"提现金额不能超过20000元"}).then(function(e){})}else if(t.withd.money>t.userList.abvalue){i.alert({title:"余额不足，无法提出！"}).then(function(e){})}else e.get(url_getcash+"&uid="+t.userId+"&money="+t.withd.money).success(function(e){t.withdrawalsData=e,i.alert({title:e.msg}).then(function(e){t.withdrawals.hide(),n.getUser(t.userId,t)})})}});